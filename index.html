<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUHAMMAD ATEEQ LAW STUDENT DIARY - Professional</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

    <style>
        :root { --primary: #002b5e; --secondary: #c0392b; --success: #27ae60; --bg: rgba(240, 242, 245, 0.9); --card: #ffffff; --text: #1c1e21; --border: #dddfe2; --input-bg: #f5f6f7; --gold: #c5a059; --accent: #002b5e; --today-bg: rgba(197, 160, 89, 0.3); --today-border: #c5a059; }
        body.dark-mode { --bg: rgba(13, 17, 23, 0.95); --card: #161b22; --text: #c9d1d9; --border: #30363d; --input-bg: #0d1117; --gold: #d29922; --accent: #1f6feb; --today-bg: rgba(210, 153, 34, 0.4); --today-border: #d29922; }
        
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: url('https://images.unsplash.com/photo-1505664194779-8beaceb93744?auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed; 
            background-size: cover; 
            margin: 0; 
            padding: 15px; 
            color: var(--text); 
            transition: 0.3s; 
            display: none; 
        }
        
        .overlay-layer { 
            background: linear-gradient(to bottom, rgba(0, 43, 94, 0.8), rgba(240, 242, 245, 0.9)); 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; 
        }

        .grid-container { max-width: 1580px; margin: auto; display: grid; grid-template-columns: 420px 1fr; gap: 20px; position: relative; padding-top: 20px; }
        header { grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: center; background: var(--primary); color: white; padding: 15px 25px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); border-bottom: 3px solid var(--gold); }
        .header-right { display: flex; align-items: center; gap: 20px; }
        .theme-toggle { background: var(--gold); color: black; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 5px; font-size: 12px; }
        .user-name { font-size: 20px; font-weight: bold; color: var(--gold); display: flex; align-items: center; gap: 10px; }
        
        .stats-header { grid-column: 1 / -1; display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .stat-box { flex: 1; min-width: 150px; background: var(--card); padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border-top: 5px solid var(--gold); cursor: pointer; transition: 0.3s; color: var(--text); border: 1px solid var(--border); }
        .stat-box:hover { transform: translateY(-3px); }
        .active-filter { background: var(--accent) !important; color: white !important; }
        
        .card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.4); margin-bottom: 20px; border: 1px solid var(--border); }
        input, select, textarea { width: 100%; padding: 10px; margin: 4px 0; border: 1px solid var(--border); border-radius: 6px; box-sizing: border-box; background: var(--input-bg); color: var(--text); font-size: 14px; }
        .row-flex { display: flex; gap: 8px; }
        
        .btn { border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; color: white; margin-top: 8px; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 13px; transition: 0.3s; }
        .btn-save { background: var(--gold); color: #000; }
        .btn-sync-send { background: #27ae60 !important; border: 2px solid #ffffff; }
        .btn-sync-get { background: #1f6feb !important; border: 2px solid #ffffff; }
        .btn-whatsapp { background: #25D366; }
        .btn-reset { background: #c0392b; }
        .btn-pass-change { background: #8e44ad; }
        
        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        thead th { background: var(--primary); color: #ffffff; padding: 18px 15px; text-align: left; font-size: 13px; text-transform: uppercase; border-bottom: 3px solid var(--gold); font-weight: 900; }
        tbody tr { background: var(--card); box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-radius: 8px; }
        tbody td { padding: 15px; vertical-align: top; }

        .tag-box { border-radius: 6px; padding: 6px 10px; margin-bottom: 6px; font-size: 12px; border-left: 5px solid; }
        .tag-box small { color: var(--gold); font-weight: 800; display: block; margin-bottom: 2px; }
        .tag-court { background: #fff3e0; color: #e65100; border-color: #ff9800; }
        .tag-judge { background: #f3e5f5; color: #7b1fa2; border-color: #9c27b0; }
        .tag-case { background: #e3f2fd; color: #0d47a1; border-color: #2196f3; }
        .tag-stage { background: #263238; color: #ffffff; border-color: #000000; }
        .tag-section { background: #fffde7; color: #f57f17; border-color: #fbc02d; }

        .tag-mark { background: #8e24aa; color: white; padding: 5px 15px; border-radius: 5px; font-weight: bold; cursor: pointer; text-align: center; display: inline-block; }
        .marked-present { background: #27ae60 !important; }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .day { padding: 8px; border: 1px solid var(--border); cursor: pointer; border-radius: 4px; font-size: 12px; background: var(--input-bg); min-height: 45px; display: flex; flex-direction: column; align-items: center; justify-content: space-between; }
        .day.today-marker { background: var(--today-bg) !important; border: 2px solid var(--today-border) !important; }
        .case-dot { background: #e74c3c; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .action-icon { cursor: pointer; font-size: 20px; margin: 0 5px; }
        .export-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 10px; }
        @media (max-width: 900px) { .grid-container { grid-template-columns: 1fr; } .export-row { grid-template-columns: 1fr 1fr; } }
    </style>
</head>
<body class="dark-mode" id="mainBody">
    <div class="overlay-layer"></div>
    <div class="grid-container">
        <header>
            <div class="user-name"><i class="fas fa-gavel"></i> MUHAMMAD ATEEQ LAW STUDENT DIARY</div>
            <div class="header-right">
                <span id="backupStatus" style="font-size: 11px; color: var(--gold);"></span>
                <div id="clock" style="font-weight: bold;"></div>
                <button class="theme-toggle" onclick="toggleDarkMode()">MODE</button>
            </div>
        </header>

        <div class="stats-header">
            <div class="stat-box active-filter" id="f-all" onclick="setFilter('all')"><small>TOTAL CASES</small><br><strong id="st-all" style="font-size:22px">0</strong></div>
            <div class="stat-box" id="f-today" onclick="setFilter('today')"><small>TODAY CASES</small><br><strong id="st-today" style="font-size:22px">0</strong></div>
            <div class="stat-box" id="f-pending" onclick="setFilter('pending')"><small>PENDING</small><br><strong id="st-pend" style="font-size:22px">0</strong></div>
            <div class="stat-box" id="f-disposal" onclick="setFilter('disposal')"><small>DISPOSED</small><br><strong id="st-disp" style="font-size:22px">0</strong></div>
        </div>

        <div class="sidebar">
            <div class="card">
                <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <button onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                    <h4 id="monthYearText" style="margin:0; color:var(--gold);"></h4>
                    <button onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-grid">
                    <div style="color:red">S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
                </div>
                <div id="calGrid" class="calendar-grid"></div>
            </div>

            <div class="card" id="formContainer">
                <h3 style="margin:0 0 10px 0; color:var(--gold);">NEW ENTRY</h3>
                <input type="hidden" id="editId">
                <input type="text" id="courtName" placeholder="Court Name">
                <input type="text" id="judgeName" placeholder="Judge Name">
                <input type="text" id="dist" placeholder="District">
                <div class="row-flex">
                    <input type="text" id="caseName" placeholder="Case Name" style="flex:2;">
                    <input type="text" id="caseNo" placeholder="No." style="flex:1;">
                </div>
                <input type="text" id="underSection" placeholder="Under Section">
                <input type="text" id="caseStage" placeholder="Current Stage">
                <select id="partySide">
                    <option value="">-- PARTY SIDE --</option>
                    <option>APPLICANT</option><option>PETITIONER</option><option>RESPONDENT</option><option>ACCUSED</option><option>COMPLAINANT</option>
                </select>
                <input type="text" id="pName" placeholder="Party Name">
                <input type="text" id="advName" placeholder="Advocate Name">
                <select id="caseStatus"><option value="Active / Pending">Active / Pending</option><option value="Disposal">Disposal</option></select>
                <div class="row-flex">
                    <input type="date" id="cDate">
                    <input type="time" id="cTime">
                </div>
                
                <button class="btn btn-save" onclick="saveData()"><i class="fas fa-save"></i> SAVE & SYNC</button>
                <button class="btn btn-whatsapp" onclick="shareFullBackupWhatsApp()"><i class="fab fa-whatsapp"></i> BACKUP WHATSAPP</button>
                <button class="btn btn-pass-change" onclick="changeDiaryPassword()"><i class="fas fa-key"></i> CHANGE DIARY PASSWORD</button>
                <button class="btn btn-reset" onclick="allResetData()"><i class="fas fa-trash-alt"></i> RESET ALL DATA</button>
            </div>
        </div>

        <div class="main-content">
            <div class="card">
                <input type="text" id="searchGen" placeholder="ðŸ” Search Cases..." onkeyup="render()" style="padding:15px;">
                <div class="export-row">
                    <button class="btn btn-sync-send" onclick="smartExport('excel')">EXCEL</button>
                    <button class="btn btn-sync-get" onclick="smartExport('pdf')">PDF REPORT</button>
                </div>
            </div>

            <div style="overflow-x:auto;">
                <table>
                    <thead>
                        <tr>
                            <th>SR.</th>
                            <th>COURT/JUDGE</th>
                            <th>SECTION</th>
                            <th>CASE/STAGE</th>
                            <th>PARTY</th>
                            <th>DATE/TIME</th>
                            <th>ATT.</th>
                            <th>ACTIONS</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDkBniNbOvggtD7l50m5H_UhSjzLDTwiI",
            authDomain: "muhammad-ateeq-law-student.firebaseapp.com",
            databaseURL: "https://muhammad-ateeq-law-student-default-rtdb.firebaseio.com",
            projectId: "muhammad-ateeq-law-student",
            storageBucket: "muhammad-ateeq-law-student.appspot.com",
            messagingSenderId: "287583661760",
            appId: "1:287583661760:web:a3cdd9d7b8a66441944725"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // --- PASSWORD SYSTEM WITH CHANGE OPTION ---
        window.runSecurity = function() {
            let savedPass = localStorage.getItem('diary_pass_v4');
            if (!savedPass) {
                let setPass = prompt("Set Your New Diary Password (Pehli Baar Password Banayein):");
                if (setPass) {
                    localStorage.setItem('diary_pass_v4', setPass);
                    alert("Password Saved! Ab ise login ke liye istemal karein.");
                    location.reload();
                } else {
                    alert("Password zaroori hai!"); location.reload();
                }
            } else {
                let attempt = prompt("Enter Diary Password:");
                if (attempt === savedPass) {
                    document.body.style.display = "block";
                } else {
                    alert("Wrong Password!"); location.reload();
                }
            }
        };
        runSecurity();

        window.changeDiaryPassword = function() {
            let old = prompt("Purana Password likhein:");
            if (old === localStorage.getItem('diary_pass_v4')) {
                let newP = prompt("Naya Password likhein:");
                if (newP) {
                    localStorage.setItem('diary_pass_v4', newP);
                    alert("Password tabdeel ho gaya hai!");
                }
            } else { alert("Ghalat Purana Password!"); }
        };

        window.syncToFirebase = function(data) { set(ref(database, 'diary_records/'), data); };
        onValue(ref(database, 'diary_records/'), (snapshot) => {
            const data = snapshot.val();
            if (data) { db = data; localStorage.setItem('ateeq_diary_v4', JSON.stringify(db)); render(); }
        });
    </script>

    <script>
        let db = JSON.parse(localStorage.getItem('ateeq_diary_v4')) || [];
        let currentFilter = 'all', calViewDate = new Date();

        function render() {
            const body = document.getElementById('tableBody');
            const search = document.getElementById('searchGen').value.toLowerCase();
            body.innerHTML = '';
            let today = new Date().toISOString().split('T')[0];

            document.getElementById('st-all').innerText = db.length;
            document.getElementById('st-today').innerText = db.filter(c => c.date === today).length;
            document.getElementById('st-pend').innerText = db.filter(c => c.status !== 'Disposal').length;
            document.getElementById('st-disp').innerText = db.filter(c => c.status === 'Disposal').length;

            let sr = 1;
            db.forEach(c => {
                let visible = true;
                if(currentFilter === 'today' && c.date !== today) visible = false;
                if(currentFilter === 'pending' && c.status === 'Disposal') visible = false;
                if(currentFilter === 'disposal' && c.status !== 'Disposal') visible = false;
                if(search && !JSON.stringify(c).toLowerCase().includes(search)) visible = false;

                if(visible) {
                    body.innerHTML += `<tr>
                        <td style="color:var(--gold); font-weight:bold;">${sr++}</td>
                        <td><div class="tag-box tag-court"><small>COURT</small><b>${c.courtName}</b></div></td>
                        <td><div class="tag-box tag-section"><b>${c.underSection}</b></div></td>
                        <td><div class="tag-box tag-case"><b>${c.caseName}</b></div><div class="tag-box tag-stage"><b>${c.caseStage}</b></div></td>
                        <td><b>${c.pName}</b></td>
                        <td><b>${c.date}</b><br><small>${c.time}</small></td>
                        <td><div class="tag-mark ${c.attended?'marked-present':''}" onclick="markAtt(${c.id})">${c.attended?'YES':'Mark'}</div></td>
                        <td>
                            <i class="fas fa-edit action-icon" onclick="editCase(${c.id})"></i>
                            <i class="fas fa-trash action-icon" onclick="deleteCase(${c.id})"></i>
                        </td>
                    </tr>`;
                }
            });
            renderCalendar();
        }

        function saveData() {
            const item = {
                id: document.getElementById('editId').value || Date.now(),
                courtName: document.getElementById('courtName').value,
                judgeName: document.getElementById('judgeName').value,
                caseName: document.getElementById('caseName').value,
                underSection: document.getElementById('underSection').value,
                caseStage: document.getElementById('caseStage').value,
                date: document.getElementById('cDate').value,
                time: document.getElementById('cTime').value,
                pName: document.getElementById('pName').value,
                status: document.getElementById('caseStatus').value,
                attended: false
            };
            let idx = db.findIndex(x => x.id == item.id);
            if(idx !== -1) db[idx] = item; else db.push(item);
            save(); clearForm();
        }

        function save() {
            localStorage.setItem('ateeq_diary_v4', JSON.stringify(db));
            if(window.syncToFirebase) window.syncToFirebase(db);
            render();
        }

        function markAtt(id) {
            let i = db.findIndex(x => x.id == id);
            db[i].attended = !db[i].attended;
            save();
        }

        function deleteCase(id) { if(confirm("Delete Case?")) { db = db.filter(x => x.id != id); save(); } }
        function editCase(id) {
            const c = db.find(x => x.id == id);
            document.getElementById('editId').value = c.id;
            document.getElementById('courtName').value = c.courtName;
            document.getElementById('caseName').value = c.caseName;
            window.scrollTo(0,0);
        }

        function clearForm() { document.querySelectorAll('input, select').forEach(i => i.value=''); document.getElementById('editId').value=''; }
        function setFilter(f) { currentFilter = f; render(); }
        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }
        function allResetData() { if(confirm("Reset Everything?")) { db=[]; localStorage.clear(); location.reload(); } }

        function renderCalendar() {
            const grid = document.getElementById('calGrid'); grid.innerHTML = '';
            const y = calViewDate.getFullYear(), m = calViewDate.getMonth();
            document.getElementById('monthYearText').innerText = new Intl.DateTimeFormat('en-US', {month:'long', year:'numeric'}).format(calViewDate);
            const last = new Date(y, m+1, 0).getDate();
            for(let d=1; d<=last; d++) {
                const ds = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const count = db.filter(c => c.date === ds).length;
                grid.innerHTML += `<div class="day">${d}${count>0?`<div class="case-dot">${count}</div>`:''}</div>`;
            }
        }
        function changeMonth(v) { calViewDate.setMonth(calViewDate.getMonth() + v); renderCalendar(); }
        
        async function shareFullBackupWhatsApp() {
            const data = btoa(unescape(encodeURIComponent(JSON.stringify(db))));
            const url = window.location.href.split('?')[0] + "?data=" + data;
            window.open(`https://wa.me/?text=${encodeURIComponent("Diary Backup Link:\n"+url)}`, '_blank');
        }

        function smartExport(type) {
            if(type === 'excel') {
                const ws = XLSX.utils.json_to_sheet(db);
                const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Diary");
                XLSX.writeFile(wb, "Ateeq_Diary.xlsx");
            } else {
                const { jsPDF } = window.jspdf; const doc = new jsPDF();
                doc.text("MUHAMMAD ATEEQ LAW DIARY REPORT", 10, 10);
                doc.save("Report.pdf");
            }
        }

        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleString(); }, 1000);
        window.onload = render;
    </script>
</body>
</html>
